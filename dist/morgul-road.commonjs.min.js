"use strict";function isObject(e){return"[object Object]"===type.call(e)}function isString(e){return"[object String]"===type.call(e)}function noop(){}function forEach(e,n){for(var t=0;t<e.length&&!n(e[t],t++););}function makeRouter(e){function n(u,d,p,m){if(0===arguments.length)return l;if(3===arguments.length&&isString(d)){h=function(e){var o=l=t(e);if(!r(u,p,o)){if(f)throw new Error("Ensure the default route matches one of the routes defined in route");f=!0,n(d,!0),f=!1}};var v="hash"===n.mode?"onhashchange":"onpopstate";return window[v]=function(){var e=location[n.mode];"pathname"===n.mode&&(e+=location.search),l!==t(e)&&h(e)},e.computePreRedrawHook=o,void window[v]()}if(u.addEventListener||u.attachEvent){var w="pathname"!==n.mode?location.pathname:"";return u.href=w+s[n.mode]+m.attrs.href,void(u.addEventListener?(u.removeEventListener("click",c),u.addEventListener("click",c)):(u.detachEvent("onclick",c),u.attachEvent("onclick",c)))}if(isString(u)){var g=l;l=u;var y,E=d||{},R=l.indexOf("?");y=R>-1?i(l.slice(R+1)):{};for(var O in E)hasOwn.call(E,O)&&(y[O]=E[O]);var b,k=a(y);b=R>-1?l.slice(0,R):l,k&&(l=b+(-1===b.indexOf("?")?"?":"&")+k);var S=(3===arguments.length?p:d)===!0||g===u;if(window.history.pushState){var j=S?"replaceState":"pushState";e.computePreRedrawHook=o,e.computePostRedrawHook=function(){window.history[j](null,document.title,s[n.mode]+l)},h(s[n.mode]+l)}else location[n.mode]=l,h(s[n.mode]+l)}}function t(e){return e.slice(s[e.mode].length)}function r(n,t,r){u={};var o=r.indexOf("?");-1!==o&&(u=i(r.substr(o+1,r.length)),r=r.substr(0,o));var a=Object.keys(t),c=a.indexOf(r);if(-1!==c)return e(n,t[a[c]]),!0;for(var l in t)if(hasOwn.call(t,l)){if(l===r)return e(n,t[l]),!0;var s=new RegExp("^"+l.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(r))return r.replace(s,function(){var r=l.match(/:[^\/]+/g)||[],o=[].slice.call(arguments,1,-2);forEach(r,function(e,n){u[e.replace(/:|\./g,"")]=decodeURIComponent(o[n])}),e(n,t[l])}),!0}}function o(){"hash"!==n.mode&&location.hash?location.hash=location.hash:window.scrollTo(0,0)}function a(e,n){var t={},r=[];for(var o in e)if(hasOwn.call(e,o)){var i=n?n+"["+o+"]":o,c=e[o];if(null===c)r.push(encodeURIComponent(i));else if(isObject(c))r.push(a(c,i));else if(isArray(c)){var u=[];t[i]=t[i]||{},forEach(c,function(e){t[i][e]||(t[i][e]=!0,u.push(encodeURIComponent(i)+"="+encodeURIComponent(e)))}),r.push(u.join("&"))}else void 0!==c&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(c))}return r.join("&")}function i(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var n=e.split("&"),t={};return forEach(n,function(e){var n=e.split("="),r=decodeURIComponent(n[0]),o=2===n.length?decodeURIComponent(n[1]):null;null!=t[r]?(isArray(t[r])||(t[r]=[t[r]]),t[r].push(o)):t[r]=o}),t}function c(e){if(e=e||event,!(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault?e.preventDefault():e.returnValue=!1;var t,r=e.currentTarget||e.srcElement;for(t="pathname"===n.mode&&r.search?i(r.search.slice(1)):{};r&&!/a/i.test(r.nodeName);)r=r.parentNode;n(r[n.mode].slice(s[n.mode].length),t)}}var u,l,s={pathname:"",hash:"#",search:"?"},h=noop,f=!1;return n.param=function(e){if(!u)throw new Error("You must call route(element, defaultRoute, routes) before calling route.param()");return e?u[e]:u},n.mode="search",n.buildQueryString=a,n.parseQueryString=i,n}var type={}.toString,isArray=Array.isArray||function(e){return"[object Array]"===type.call(e)},hasOwn={}.hasOwnProperty;module.exports=makeRouter;